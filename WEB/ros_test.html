<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <link rel="stylesheet" type="text/css" href="css/control_ros.css">

    <script src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>


    <script>
      // This function connects to the rosbridge server running on the local computer on port 9090
      var rosServer = new ROSLIB.Ros({
          url : 'ws://192.168.43.7:9090'
      });

      // If there is an error on the backend, an 'error' emit will be emitted.
      rosServer.on('error', function(error) {
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('connected').style.display = 'none';
        document.getElementById('closed').style.display = 'none';
        document.getElementById('error').style.display = 'inline';
        console.log(error);
      });

      // Find out exactly when we made a connection.
      rosServer.on('connection', function() {
        console.log('Connection made!');
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('error').style.display = 'none';
        document.getElementById('closed').style.display = 'none';
        document.getElementById('connected').style.display = 'inline';
      });

      rosServer.on('close', function() {
        console.log('Connection closed.');
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('connected').style.display = 'none';
        document.getElementById('closed').style.display = 'inline';
      });


    // These lines create a topic object as defined by roslibjs
    var forwardTopic = new ROSLIB.Topic({
        ros : rosServer,
        name : 'forward',
        messageType : 'std_msgs/Empty'
    });
    var backwardTopic = new ROSLIB.Topic({
        ros : rosServer,
        name : 'backward',
        messageType : 'std_msgs/Empty'
    });
    var rightTopic = new ROSLIB.Topic({
        ros : rosServer,
        name : 'right',
        messageType : 'std_msgs/Empty'
    });
    var leftTopic = new ROSLIB.Topic({
        ros : rosServer,
        name : 'left',
        messageType : 'std_msgs/Empty'
    });
    var stopTopic = new ROSLIB.Topic({
        ros : rosServer,
        name : 'stop',
        messageType : 'std_msgs/Empty'
    });
    var upTopic = new ROSLIB.Topic({
        ros : rosServer,
        name : 'up',
        messageType : 'std_msgs/Empty'
    });
    var downTopic = new ROSLIB.Topic({
        ros : rosServer,
        name : 'down',
        messageType : 'std_msgs/Empty'
    });

    /* This function:
    - retrieves numeric values from the text boxes
    - assigns these values to the appropriate values in the twist message
    - publishes the message to the cmd_vel topic.
    */
    function pubMessage(topic) {
      topic.publish();
    }

    // TEST
		var listeBureaux = new ROSLIB.Topic({
			ros : rosServer,
			name : '/listeBureaux',
			messageType : 'std_msgs/String'
		});
		// "44;55;66"
		var messageBureaux = new ROSLIB.Message('{"lucas est dans le binks"}');
		var messageBureaux2 = new ROSLIB.Message("lucas est dans le binks");
    function testMSG() {
      listeBureaux.publish(messageBureaux);
      listeBureaux.publish(messageBureaux2);
    }

    </script>

  </head>

  <body>
    <div class="divTop">
      <div id="statusIndicator">
        <p id="connecting">
          Connecting to rosbridge...
        </p>
        <p id="connected" style="color:#00D600; display:none">
          Connected
        </p>
        <p id="error" style="color:#FF0000; display:none">
          Error in the backend!
        </p>
        <p id="closed" style="display:none">
          Connection closed.
        </p>
      </div>

      <div class="divCenter">
        <h1>/cvcamera/image_rav</h1>
        <img src="http://192.168.43.197:8080/stream?topic=/cv_camera/image_raw" />





        
      </div>

      <br>
      </div>

    <div class="divBottom">
      <form name="ctrlPanel">
        <div class="main">
          <div class="sub-main">
            <button id="sendMsg" type="button" onclick="pubMessage(forwardTopic)" class="button-one">Avancer</button>
          </div>
          <div class="sub-main">
            <button id="sendMsg" type="button" onclick="pubMessage(backwardTopic)" class="button-one">Reculer</button>
          </div>
          <div class="sub-main">
            <button id="sendMsg" type="button" onclick="pubMessage(stopTopic)" class="button-one button-stop">Stop</button>
          </div>
          <div class="sub-main">
            <button id="sendMsg" type="button" onclick="pubMessage(leftTopic)" class="button-one">Gauche</button>
          </div>
          <div class="sub-main">
            <button id="sendMsg" type="button" onclick="pubMessage(rightTopic)" class="button-one">Droite</button>
          </div>
          <br><br>
          <div class="sub-main">
            <button id="sendMsg" type="button" onclick="pubMessage(upTopic)" class="button-one">V+</button>
          </div>
          <div class="sub-main">
            <button id="sendMsg" type="button" onclick="pubMessage(downTopic)" class="button-one">V-</button>
          </div>
        </div>
      </form>
    </div>
  </body>
</html>

 